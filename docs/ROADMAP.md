# EvoSkill 开发路线图

> 基于总目标：打造具备自我进化能力的 AI 编程助手

## 总目标拆解

```
EvoSkill = AI 编程助手 + Skill 自我进化 + 智能上下文管理
         = (对话 + 工具) + (Skill 创建/优化/进化) + (上下文压缩/记忆)
```

---

## 第一阶段：核心基础 ✅ COMPLETED

**状态**: 已完成 (v0.1.0)

- [x] 项目基础架构
- [x] LLM Provider 抽象（OpenAI/Anthropic/Kimi-Coding）
- [x] 基础工具系统（读文件、写文件、目录、搜索、命令、URL）
- [x] CLI 交互框架
- [x] 配置管理系统
- [x] 测试框架建立
- [x] Kimi For Coding 集成

---

## 第二阶段：上下文智能管理 🚧 IN PROGRESS

**目标**: 实现基于 Pi Agent 设计的上下文压缩机制

**核心问题**: 当对话历史超过 `max_context_tokens` 时如何处理？

### 2.1 上下文压缩 (Context Compaction)

**设计**: Pi Agent 论文中的策略
- 当上下文达到 80% 阈值时触发压缩
- 使用 LLM 生成对话摘要
- 保留系统提示和关键信息

**实现任务**:
- [ ] `evoskill/core/context.py` - 实现 `ContextCompactor` 类
- [ ] 摘要生成策略：保留工具定义、保留关键决策点
- [ ] 用户确认：压缩前询问用户
- [ ] 压缩质量评估：确保不丢失关键信息

**优先级**: 🔴 高（这是 Pi Agent 的核心特色）

### 2.2 会话持久化

**目标**: 保存和恢复对话状态

**实现任务**:
- [ ] `Session.save()` - 保存消息历史到 JSON/YAML
- [ ] `Session.load()` - 恢复会话状态
- [ ] CLI 命令：`/save <name>` 和 `/load <name>`
- [ ] 自动保存：定期保存到 `.evoskill/sessions/`

**优先级**: 🟡 中

### 2.3 Token 使用监控

**目标**: 实时显示 Token 消耗

**实现任务**:
- [ ] 统计每轮对话的 input/output tokens
- [ ] 显示上下文窗口占用比例
- [ ] 告警：当接近上限时提示

**优先级**: 🟢 低

---

## 第三阶段：Skill 自我进化系统 🚧 IN PROGRESS

**目标**: 实现真正的 Skill 自我进化（项目核心特色）

### 3.1 Skill 创建工作流

**当前状态**: 有 `/create` 命令，但流程不完整

**完善任务**:
- [ ] 用户需求分析 → Skill 设计
- [ ] 自动生成 SKILL.md（改进 prompts）
- [ ] 自动生成代码（main.py）
- [ ] 自动生成测试（tests/test_*.py）
- [ ] 自动验证：运行测试确保 Skill 可用

**优先级**: 🔴 高

### 3.2 Skill 进化循环

**设计**: 当现有工具不满足需求时，自动创建新 Skill

**触发条件**:
```
用户请求 → 检查现有 Skills → 不匹配 → 进入进化流程
```

**实现任务**:
- [ ] `SkillEvolutionEngine.analyze_need()` - 分析需求
- [ ] 匹配现有 Skills，计算相似度
- [ ] 决策：使用现有 / 修改现有 / 创建新 Skill
- [ ] 自动集成：新 Skill 立即可用

**优先级**: 🔴 高（核心差异化功能）

### 3.3 Skill 优化与迭代

**目标**: 根据使用反馈改进 Skills

**实现任务**:
- [ ] 收集 Skill 使用数据（成功率、用户反馈）
- [ ] 自动修复：测试失败时自动修改
- [ ] 版本管理：Skills 的版本控制
- [ ] 回滚机制：新 Skill 失败时回滚到旧版本

**优先级**: 🟡 中

---

## 第四阶段：增强工具系统 📋 PLANNED

### 4.1 更多内置 Skills

**优先级高的 Skills**:
- [ ] `git` - Git 操作（status, diff, commit, branch）
- [ ] `web_search` - 网络搜索（Google/Serper）
- [ ] `database` - 数据库操作（SQLite）
- [ ] `http_api` - HTTP API 测试
- [ ] `docker` - 容器管理

**优先级**: 🟡 中

### 4.2 工具链组合

**目标**: 多个工具组合成工作流

**示例**:
```
"分析项目并生成报告" → 
  1. list_dir (了解结构)
  2. search_files (找关键代码)
  3. read_file (读取核心文件)
  4. write_file (生成报告)
```

**实现任务**:
- [ ] 工具依赖图
- [ ] 并行执行独立工具
- [ ] 结果传递机制

**优先级**: 🟢 低

---

## 第五阶段：用户体验优化 📋 PLANNED

### 5.1 交互增强

- [ ] 代码语法高亮输出
- [ ] Markdown 渲染
- [ ] 图片显示（如果 LLM 返回图片）
- [ ] 进度指示（长时间操作）

### 5.2 错误恢复

- [ ] LLM API 重试机制（指数退避）
- [ ] 工具执行失败重试
- [ ] 网络错误恢复
- [ ] 优雅降级（切换到备用 Provider）

### 5.3 性能优化

- [ ] 异步工具并行执行
- [ ] 文件缓存
- [ ] 增量索引（大项目）

---

## 第六阶段：生产就绪 📋 PLANNED

### 6.1 安全加固

- [ ] 工具执行沙箱（限制权限）
- [ ] 敏感文件保护（.env, ssh keys）
- [ ] 命令白名单/黑名单
- [ ] 审计日志

### 6.2 多用户支持

- [ ] 用户配置隔离
- [ ] 团队协作（共享 Skills）

### 6.3 发布准备

- [ ] 完善的错误提示
- [ ] 详细的日志系统
- [ ] 安装包（pip install）

---

## 当前建议：下一步做什么？

基于当前状态（v0.1.0 + 测试框架），建议按以下顺序：

### 选项 A：上下文压缩（推荐）
**原因**: 这是 Pi Agent 的核心，也是区分于其他工具的关键
**工作量**: 中等（2-3 天）
**影响**: 大大提升长对话体验

### 选项 B：完善 Skill 创建
**原因**: 这是项目的核心卖点
**工作量**: 中等（2-3 天）
**影响**: 让 `/create` 真正可用

### 选项 C：Git Skill
**原因**: 程序员最常用的工具
**工作量**: 小（1 天）
**影响**: 立即提升实用性

---

## 技术债务

需要改进的代码：
- [ ] Session 初始化时自动注册内置工具
- [ ] 错误处理更详细（区分网络/权限/参数错误）
- [ ] LLM Provider 的重试机制
- [ ] 配置文件热重载

---

## 里程碑规划

| 版本 | 目标 | 预计时间 |
|------|------|----------|
| v0.2.0 | 上下文压缩 + Skill 创建完善 | 1-2 周 |
| v0.3.0 | Skill 进化循环 + Git Skill | 2 周 |
| v0.4.0 | 更多内置 Skills + 性能优化 | 2 周 |
| v1.0.0 | 生产就绪（安全 + 稳定） | 1 个月 |

---

## 你的选择？

请告诉我：
1. **下一步优先做哪个**？（A/B/C/其他）
2. **有没有特别想实现的功能**？
3. **时间安排**？（全职/兼职，每天能投入多久）
